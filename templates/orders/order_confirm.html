{% extends "base.html" %}
{% block title %}Подтвердите заказ{% endblock %}
{% block content %}
<div class="container mt-5">
    <h2>Подтверждение заказа</h2>

    {% if form.errors %}
        <div class="alert alert-danger">
            {% for error in form.non_field_errors %}
                <p>{{ error }}</p>
            {% endfor %}
        </div>
    {% endif %}

    <form method="post" id="order-form">
        {% csrf_token %}
        {{ form.as_p }}

        <div id="delivery-fields">
            <h4>Данные доставки</h4>
            <div class="mb-3">
                <label for="{{ form.address.id_for_label }}" class="form-label">Адрес доставки</label>
                {{ form.address }}
                {{ form.address.errors }}
            </div>

            <div class="mb-3">
                <label for="id_delivery_date" class="form-label">Желаемая дата доставки</label>
                <input type="date" name="delivery_date" id="id_delivery_date" class="form-control">
            </div>

            <div class="mb-3">
                <label for="id_delivery_time" class="form-label">Желаемое время доставки</label>
                <input type="time" name="delivery_time" id="id_delivery_time" class="form-control">
            </div>
        </div>

        <div id="pickup-fields" style="display: none;">
            <h4>Пункт самовывоза</h4>
            <select name="pickup_point" class="form-select mb-3">
                {% for point in pickup_points %}
                <option value="{{ point.0 }}">{{ point.1 }}</option>
                {% endfor %}
            </select>
        </div>

        <button type="submit" class="btn btn-success">Оформить заказ</button>
    </form>

    <hr class="my-4">

    <h4>Ваша корзина</h4>
    <ul>
        {% for item in cart_items %}
        <li>{{ item.product.name }} — {{ item.quantity }} × {{ item.product.price }} ₽ = {{ item.total }} ₽</li>
        {% endfor %}
    </ul>
    <p><strong>Итого:</strong> {{ total_price }} ₽</p>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const deliveryType = document.querySelector("[name='delivery_type']");
    const deliveryFields = document.getElementById("delivery-fields");
    const pickupFields = document.getElementById("pickup-fields");

    function toggleFields() {
        if (deliveryType.value === 'pickup') {
            deliveryFields.style.display = 'none';
            pickupFields.style.display = 'block';
        } else {
            deliveryFields.style.display = 'block';
            pickupFields.style.display = 'none';
        }
    }

    if (deliveryType) {
        deliveryType.addEventListener('change', toggleFields);
        toggleFields();  // Вызываем при загрузке страницы
    }
});
</script>
{% endblock %}